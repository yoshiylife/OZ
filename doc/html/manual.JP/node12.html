<!DOCTYPE HTML PUBLIC "-//W3O//DTD W3 HTML 2.0//EN">
<!Converted with LaTeX2HTML 95 (Thu Jan 19 1995) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds >
<!Actually with its Japanized version JLaTeX2HTML 95 (Wed Mar 1 1995) by Masahiro Kitagawa (kitagawa@ee.es.osaka-u.ac.jp), Osaka University >
<HEAD>
<TITLE>3.1 OZ++プログラムの作り方</TITLE>
</HEAD>
<BODY>
<meta name="description" value="3.1 OZ++プログラムの作り方">
<meta name="keywords" value="main">
<meta name="resource-type" value="document">
<meta name="distribution" value="global">
<P>
 <H2><A NAME=SECTION00041000000000000000>3.1 OZ++プログラムの作り方</A></H2>
<P>
<H3><A NAME=SECTION00041100000000000000>3.1.1 概要</A></H3>
<P>
本説明書は、OZ++システムにおけるプログラミング作業を理解するために、
簡単なプログラムのコーディング、コンパイル、実行の方法を述べるものです。
そのために、このドキュメントは初心者を対象に正確さより分かり易さに重点を
置いています。
また各ツールの機能の一部を紹介しているに過ぎません。
基本的な操作を理解した後に詳細については
各ツール個別のドキュメントを参照して下さい。
<P>
<H3><A NAME=SECTION00041200000000000000>3.1.2 使い方</A></H3>
<P>
エクゼキュータを立ちあげるまで <BR>
<P>
OZ++は既存OS上で分散環境を提供するミドルソフトウェアです。
各ユーザは既存OS上でエクゼキュータと呼ばれるプログラムを実行する必要が
あります。
そして、すべてのOZ++プログラムはエクゼキュータ上で実行されます。
またOZ++プログラムのコンパイルもこのOZ++の環境上で行ないます。
ここではエクゼキュータを立ちあげてプログラミングを行う環境を用意する
手順を説明します。
<P>
<OL><LI> 個人環境の設定<BR> 
以下の環境変数を設定します。
<blockquote> % setenv OZROOT ＜インストールしたディレクトリ＞ <BR> 
        % setenv PATH $OZROOT/bin:$PATH
</blockquote>
<P>
以下、各プロセスは環境変数が設定されていることを前提とします。
<P>
<LI> 各種デーモンを起動
<blockquote> % ncl
</blockquote>
nclは「ニュクリアス」と呼ばれるプログラムを起動するコマンドです。
このプログラムは、OZ++システムのデーモンのひとつです。これは
ワークステーション間でのメッセージ呼び出しの際にアドレス解決を行なったり、
コードの配送に必要なデーモンを起動したりします。「ニュクリアスの説明」
を参照してください。
<P>
<LI> ニュクリアスフロントエンドの起動<BR> 
ニュクリアスフロントエンドはエクゼキュータの生成、管理を行なうためのツールで
す。またエクゼキュータの実行に必要なオブジェクトイメージの生成も行ないます。
「ニュクリアスフロントエンドの説明」を参照して下さい。
UNIXのシェルから以下のようにして実行する。
<blockquote> % nfe
</blockquote>
nfeを実行すると以下のプロンプトが現れます。
<blockquote> nfe<b>&gt;</b></blockquote>
<P>
<LI> Site master の作成<BR> 
OZ++を起動するにはサイトにひとつSite masterという
役割を担うエクゼキュータが必要です (「管理オブジェクトの配置」を
参照して下さい)。

<P>
「イメージの作り方」を参照して、 Site master を作成して下さい。
例えば、以下のようにします。
<blockquote> nfe<b>&gt;</b> newimage -k site-master -d your.domain.jp -u yourname -n site-master
</blockquote>
<P>
<LI> Site masterの起動
<blockquote> nfe<b>&gt;</b> cex $site-master
</blockquote>
cexとはエクゼキュータを起動するnfeのコマンドです。
引数には、先ほど作成した Site master の名前を指定して下さい。
名前をつけなかったなら、エクゼキュータ ID を指定しても構いません。
十分ほどすると、OZ++Launcherが立ち上がります。
<P>
どのようなエクゼキュータを作ったのか
一覧を見たい場合は、以下のコマンドを実行して下さい。
<blockquote> nfe<b>&gt;</b> exidlist
</blockquote>
<P>
<LI> エクゼキュータイメージの生成 <BR> 
プログラミング環境を提供するエクゼキュータを実行するためには
新たにエクゼキュータのイメージファイルが必要です。
まずnfeから以下のコマンドを入力します。
<blockquote> nfe<b>&gt;</b> newimage -n demo
</blockquote>
すると以下が現れます。
<PRE>        What kind of image do you want?
            1. Site master
            2. Station master
            3. Slave with a class object
            4. Slave with no class object
            9. Fully customized
            0. Help

        ?
</PRE>
newimageコマンドはエクゼキュータの運用形態により適切な設定を
行なうようにオプションが用意されいます。
通常は２番のStation masterを選択します。
<PRE>        ? 2             ←２番を入力
</PRE>
２番を選ぶと以下のデータの入力が促されます。

<P>
ドメイン名には Site master と同じものを、
ユーザ名にはあなたのユーザ名を指定して下さい。
<PRE>        Enter domain name ? oz.ipa.go.jp
        Who are you [oz++] ?
</PRE>
入力が終るとイメージファイルが作成されます。
<PRE>        Creating preload direction files ...
</PRE>
Site masterとStaion masterは別のマシンで動作させることも可能です。
少なくともサイトに１つSite masterがあり、
プログラマ用に１つStation masterが
あれば実行できます。詳しくは「サイトの説明」を参照して下さい。
<P>
<LI> エクゼキュータの実行 <BR> 
newimageが終了してから、そのエクゼキュータを立ちあげます。
nfeより以下のコマンドを入力します。
<blockquote> nfe<b>&gt;</b> cex $demo
</blockquote>

<P>
</OL>
<P>
簡単な例 <BR>
<P>
C言語の入門に使われる題材として、&quot;Hello world&quot;という文字列を
端末に出力するプログラムが有名です。
ここでは、同様の機能をOZ++言語で作成する例を挙げます。
<P>
<OL><LI> コーディング <BR> 
OZ++のソースはC言語などと同じようにまずファイルを作成します。
以下のソースファイルを`hello.oz'という名前で作成します。
<P>
<PRE>// hello.oz
class Hello : Launchable {
  void Launch(){
    // declare
    Console win;
    String hello;

    // construct
    win =&gt; New();
    hello =&gt; NewFromArrayOfChar( &quot;Hello world.\n&quot; );

    // act
    win -&gt; Open();
    win -&gt; Write( hello );
    win -&gt; Read(); // press any key
    win -&gt; Close();
  }
}
</PRE>
以下にこのプログラムを簡単に説明します。
<OL><LI>
OZ++ 言語はオブジェクト指向言語であり、
プログラムはすべてクラスから構成されます。
これはHelloという名前のクラスです。
スーパークラスはLaunchableというシステム
が用意しているクラスです。
これはLauncherからプログラムを実行する時に用いる
クラスです。
<P>
<LI> Launch()というのがメソッドであり、Launcherはこのメソッドを
実行します。Helloクラスはメソッドを１つだけ持つクラスです。
<P>
<LI> winとhelloはメソッドLaunchの局所変数で、
それぞれConsole、Stringというクラスを
型とする変数です。Consoleはktermを利用したターミナルウインドウを
提供するクラスです。Stringは文字列を提供するクラスです。
 `//'から行末までは、C++と同様、コメントです。
 C言語のように/* .. */というスタイルのコメントも併用できます。
<P>
<LI> ワークベンチ
<P>
OZ++のコンパイルはOZ++の開発環境のもとで行ないます。
コンパイルを行なうためにはワークベンチというツールを起動します。
ワークベンチはコンパイラやブラウザ等、プログラムの開発に必要なツールをまとめ
たものです。「ワークベンチの説明」を参照。ワークベンチは、ランチャーという
ツールを用いて起動します。「ランチャーの説明」を参照して下さい。
<OL><LI> ワークベンチの実行
<P>
Launcher の Create メニューから Object を選択します。 `Class' フィールドに 
`0001000002000413' 、 `Name' フィールドに `wb' を入力して accept ボタンを押し
ます。右側のリストボックスに wb (`Name' フィールドで入力した名前) という表示
が現れるので、それをダブルクリックします。
<P>
<LI> ワークベンチの初期処理
<P>
ワークベンチのPreferenceウインドウが表示されるので、 $demo エグゼキュータの
クラスオブジェクトの名前を入力します。クラスオブジェクトにどのような名前がつ
くのかは、「newimageの説明」に書いてあります。たいていは、 `:classes:xxxxxx' 
という名前で、 `xxxxxx' の部分には、エグゼキュータ番号が入ります (エグゼキュー
タ ID が 0001001003000000 ならば、エグゼキュータ番号は 001003 です)。 `Done'
ボタンを押すとワークベンチのトップウインドウが現れます。
</OL>
<P>
<LI> コンパイルとコンフィグレーション
<OL><LI> スクールの作成
<P>
ワークベンチのトップウインドウはスクールの一覧を表示します。最初は何も表示さ
れていません。スクールを最初から作るのは大変なので、ブート用スクールをコピー
します。まず `Operation'メニューから`Add'を選択します。スクール名をきいてきま
すから、適当な名前（ここでは`test'にしましょう）を入力します。次にファイルセ
レクタが $OZROOT/etc 以下を開いて、どのスクールファイルを使うのか聞いてきま
す。右側のリストボックスに boot-school と表示されているはずですから、それをダ
ブルクリックして下さい。トップウインドウに`test'が表示されます。
<P>
<LI> コンパイラフロントエンドの起動
<P>
トップウインドウで`test'の項目をダブルクリックするとポップアップメニューが現
れます。`Compiler'を選択するとコンパイラフロントエンド（CFE）の操作画面が現れ
ます。
<P>
<LI> ファイルの選択
<P>
CFE の `Compiler' メニューから `Add' を選択すると、ファイルセレクタが開きま
す。このファイルセレクタでソースファイルを選択してCFEへ取り込んで下さい。ソー
スファイル（先ほど作ったhello.oz）がカレントディレクトリ直下にあればそれをダ
ブルクリックします。なければそのディレクトリまで移動して下さい。これは、左側
のディレクトリリストを順時選択していくことで可能です。上位ディレクトリへ移動
したいときは`..'をダブルクリックします。hello.ozを選択すると、CFEにそれが表示
されます。
<P>
<LI> コンパイル
<P>
CFEのhello.ozをダブルクリックするとポップアップメニューが現れます。`Compile' 
を選択すると、コンパイルオプションを指定するダイヤログボックスが現れます。そ
のスクールでこのファイルをコンパイルするのが最初のことであれば、`New'を選択し
て、サブメニューから `from public' を選択して下さい。しばらくしてまた同じダイ
ヤログボックスが表示されますから、今度は `All' を選択します。 New はスクール
にコンパイルするクラスのエントリを登録したり、新しいバージョンを作成するため
の機能ですので、単に再コンパイルするだけであれば、２回目以降のコンパイルでは
不要です。もしコンパイルにエラーがあればエラーダイアログが表示されます。 CFE 
でのマウスカーソルが時計の形から標準の形に戻れば（そしてエラーダイアログが表
示されなければ）コンパイルは成功です。
<P>
<LI> コンフィグレーション
<P>
コンパイルが終了するとコンフィグレーションを行います。再びCFEのhello.ozをダ
ブルクリックして下さい。今度は`Configuration'を選択します。ダイヤログボックス
が現れますので、 Goボタンをクリックして下さい。コンパイル作業は複雑ですので
「ワークベンチの説明」を良く読んでから作業することをお勧めします。
<P>
<LI> カタログへの登録
<P>
ワークベンチのトップウインドウに戻ってスクールをダブルクリックします。ポップ
アップメニューが現れるので今度は`School Browser'を選択しましょう。スクールブ
ラウザが現れます。 `Operation-Search'メニューを選択するとダイヤログボックスが
現れますから、 ``Hello'' と入力し、 `Go' ボタンを押して下さい。コンパイルした 
Helloクラスの各パートのIDが表示されます。続いて `Package'ボタンを押して下さい。
パッケージされるクラスの一覧が表示されます。その下にある `Default'ボタンを押
すと、ダイアログボックスが開きますので、パッケージ名（例えば`Hello'）を入力し
て `Done' ボタンを押して下さい。カタログブラウザが現れます。 `Select'ボタンを
押せば、登録が終了します。
</OL>
<P>
<LI> 実行
<P>
プログラムの実行は Launcher から行ないます。
まずCreate-Packageメニューを選びます。
先ほど入力したHelloが右側のentriesリストに
あるはずです。Helloをマウスで選択（シングルクリック）してから右下の`Select'
ボタンを押します。
 Launcherのラジオボタン（オブジェクト-パッケージの切替え）をパッケージ側にする
とHelloが表示されるはずです。それをダブルクリックするとダイアログボックスが
現れます。`Hello1'と入力して`accept'ボタンを押します。
 ラジオボタンをオブジェクト側に切替えます。右側のリストボックスに今入力した
`Hello1'が表示されるはずです。それをダブルクリックします。ktermが現れて、
``Hello world.''が表示されます。リターンキーを入力するとウインドウが消えます。
</OL></OL>
<P>
	<BR> <HR>
<P><ADDRESS>
Copyright 1994-1997 Information-technology Promotion Agency, Japan
</ADDRESS>
</BODY>
