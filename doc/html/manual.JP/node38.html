<!DOCTYPE HTML PUBLIC "-//W3O//DTD W3 HTML 2.0//EN">
<!Converted with LaTeX2HTML 95 (Thu Jan 19 1995) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds >
<!Actually with its Japanized version JLaTeX2HTML 95 (Wed Mar 1 1995) by Masahiro Kitagawa (kitagawa@ee.es.osaka-u.ac.jp), Osaka University >
<HEAD>
<TITLE>5.18 コンストラクタ</TITLE>
</HEAD>
<BODY>
<meta name="description" value="5.18 コンストラクタ">
<meta name="keywords" value="main">
<meta name="resource-type" value="document">
<meta name="distribution" value="global">
<P>
 <H2><A NAME=SECTION000618000000000000000>5.18 コンストラクタ</A></H2>
 <A NAME=langlangmanualconstructor>　</A>
<P>
コンストラクタとは, あるクラスまたはスタティッククラスのインスタンスの
生成時に呼ばれる特別なメソッドであり、一般にインスタンスの初期化のため
の処理を行なうものである。
<P>
インスタンスの生成と初期化という操作を別々のものと考え、初期化を通常の
メソッドによって行なう場合には次のような問題がある。
<P>
<UL><LI> インスタンスの生成と初期化というのは連続した操作であり、この二つの
操作の間にそのオブジェクトに対して他のメソッドが実行されることがあって
はならない。ところが二つの操作に分けている限り、言語でこれを制限するこ
とができない。
</UL>
<P>
 OZ++
  言語ではコンストラクタを導入することによって、インスタンスの生成と初
期化を一つの操作とすることによってこの問題を解決する。ただし、ユーザが
プログラムに記述するのは初期化の部分のみである。
<P>
<H3><A NAME=SECTION000618100000000000000>5.18.1 特徴</A></H3>
<P>
 OZ++
  言語のコンストラクタは以下のような特徴を持つ。
<P>
<OL><LI> 任意の数の引数が使用可能である
<LI> 一つのクラスまたはスタティッククラスに複数のコンストラクタを定義
可能である
<LI> コンストラクタは返り値の型が <tt> void</tt> のメソッドとして定義する
<LI> アクセス制御によってコンストラクタであることを指定する 
(<A HREF="node33.html#langlangmanualclassaccesscontrol">5.13.3</A>、
<A HREF="node34.html#langlangmanualstaticclassaccesscontrol">5.14.3</A> 節参照)
<P>
</OL>
<P>
このように 3 の制限以外では、定義上は通常のメソッドと違いはなく、 OZ++
<P>
におけるコンストラクタはアクセス制御により <tt> constructor</tt> と指定さ
れたメソッドの一つである。
<P>
ところがコンストラクタの呼び出しは、あくまでもインスタンスの生成という
特別な処理を要求するものであり、これを通常のメソッド呼び出しと同様に記
述することは問題である。 OZ++
  では、C++ のようにクラス型の変数が宣言され
た時点でコンストラクタが自動的に呼ばれインスタンスが生成されるというこ
とはない。クラス型の変数が宣言されただけでは、その変数はインスタンスへ
の参照を持たず、その変数に対してコンストラクタを呼び出すことによって生
成されたインスタンスの参照がその変数に格納される。このように、 OZ++
  にお
けるコンストラクタ呼び出しは、
<P>
<UL><LI> インスタンス生成のための特別な操作
<P>
<LI> インスタンスが存在しない状態でのメソッド呼び出し
</UL>
<P>
という二つの点で特別なものであるため、言語上これを区別し次の
ように記述する。
<P>
<PRE>class A {
  constructor: m1, m2;

  void m1(int a) { ... }

  void m2() { ... }
};

A a, b;

a=&gt;m1(10); // コンストラクタの呼び出し
b=&gt;m2();   // コンストラクタの呼び出し
</PRE>
<P>
また、 OZ++
  ではネットワークを利用した分散アプリケーションを記述するため
に、他のエグゼキュータ上のグローバルオブジェクトの生成を記述できること
が必要である。したがって、コンストラクタ呼び出しにおいて生成するエグゼ
キュータの指定をオプションとして可能とする。具体的には、エグゼキュータを
 OZ++
  のオブジェクトとして抽象しているオブジェクトマネージャを指定し、次
のように記述する。
<P>
<PRE>global A a;
global ObjectManager om = Where ();

a=&gt;m1 (10)@om;
</PRE>
<P>
なお  OZ++
  言語では、引数を必要とせず、かつインスタンス変数をゼロクリア
するだけのコンストラクタもプログラマが明示的に定義を行なう。そのような
コンストラクタは以下のように実装部分を空ブロックで記述する。
<P>
<PRE>class A {
  constructor: new;

  void new() {}
}
</PRE>
<P>
<H3><A NAME=SECTION000618200000000000000>5.18.2 コンストラクタの継承</A></H3>
<P>
C++ 言語においては、子クラスのインスタンスを生成する場合には、その
クラスのコンストラクタが呼ばれた後、自動的に親クラスのコンストラク
タが呼ばれる。しかし、これはプログラム中には直接現われない継承木に沿っ
たコンストラクタの呼び出し順序を意識しなければならないという負担をプロ
グラマにかけることになる。
<P>
 OZ++
  言語では自動的に親クラスのコンストラクタを呼び出さない。
また、子クラスでは親クラスに定義されたコンストラクタは通常のメソッドと
して継承される。したがって子クラスでは、親クラスのコンストラクタを通常
のメソッドとして利用するか、アクセス制御の指定によって子クラスでもコン
ストラクタとして利用するかを、ユーザが選択可能である。
<P>
<H3><A NAME=SECTION000618300000000000000>5.18.3 コンストラクタの多重呼び出し</A></H3>
<P>
<PRE>A a;

a=&gt;m1(10);
... 
a=&gt;m1(20);
</PRE>
<P>
上の例において二度目のコンストラクタ呼び出しでは、それまで <tt> a</tt> に
結び付いていたインスタンスへの参照をなくし、新たに生成したインス
タンスの参照が <tt> a</tt> に格納される。
<P>
<H3><A NAME=SECTION000618400000000000000>5.18.4 インスタンスの生成</A></H3>
<P>
上述のコンストラクタは、メモリ上にインスタンスが生成された後、そのイン
スタンスに対して初期化処理等を行なうためのものである。つまりコンストラ
クタが実行される前に、メモリ上にはすでにインスタンスのための領域が確保
され、インスタンス変数の領域はすべてゼロクリアされている。 OZ++
  ではこの
部分の処理をユーザから隠すことによって、ユーザによるメモリ管理を不要に
している。
<P>
このインスタンスのためのメモリ領域の確保等を含むメモリ管理の処理は、エ
グゼキュータによって行なわれる。グローバルオブジェクト単位にセルと呼ぶ
ヒープが生成され、そのセル単位にページング等の処理が行なわれる。またグ
ローバルオブジェクトが持つローカルオブジェクトはセル内に作成される。
<P>
<H3><A NAME=SECTION000618500000000000000>5.18.5 インスタンスの削除</A></H3>
<P>
  OZ++
  では、ローカルオブジェクトを明示的に削除することをプログラム
に直接記述することはできない。ローカルオブジェクトは参照されなくなった
時点で GC によって暗黙的に削除される。一方、クラスのインスタンスへの参
照を持つ変数に、0 を代入することによって、その変数のインスタンスに対す
る参照を切ることができる。したがって、ローカルオブジェクトはそれへの参
照をもつ変数に 0 を代入し参照をすべてなくすことによって、次に GC が実
行された段階で削除されるため、間接的に消去することは可能である。ただし、
GC を明示的に実行する手段はない。
<P>
グローバルオブジェクトは、それを管理しているオブジェクトマネージャのサー
ビスを利用して消去を行なうことが可能である。
<P>

<P>

<P>
<BR> <HR>
<P><ADDRESS>
Copyright 1994-1997 Information-technology Promotion Agency, Japan
</ADDRESS>
</BODY>
